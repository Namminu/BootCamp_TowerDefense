# Tower Defense Game

#### íƒ€ì›Œ ë””íœìŠ¤ ê²Œì„ íŒ€í”„ë¡œì íŠ¸
<br>

## w. 1ì¡°

> **team notion**:

https://teamsparta.notion.site/1-c0359d3171d2496dbf830047246ef127

> **team leader**:

https://github.com/Namminu
<br>

> **team member**

https://github.com/cat10ho/sparta
<br>
https://github.com/ppiok-OwO
<br>
https://github.com/dkcp
<br>
https://github.com/ssy1248
<br>
https://github.com/ssini-oh
<br>

## í”„ë¡œì íŠ¸ ì„¸íŒ…
```cmd
# IDE : VSCode

# main framword : Express, socketIO

# package manager : yarn

# DB : MYSQL

# ORM : Prisma

```
<br>

## ê²Œì„ ì†Œê°œ
ë‚´ë°°ìº  íƒ€ì›Œë””íœìŠ¤ëŠ” ê·€ì—¬ìš´ ê³ ì–‘ì´ íƒ€ì›Œë“¤ì„ ë°°ì¹˜í•˜ì—¬ ì¥ë“¤ì˜ ì¹¨ì…ì„ ë§‰ëŠ” ì „ëµ ê²Œì„ì…ë‹ˆë‹¤.
ë‹¤ì–‘í•œ íŠ¹ì„±ì„ ê°€ì§„ íƒ€ì›Œë“¤ì„ ì ì ˆíˆ ë°°ì¹˜í•˜ê³  ì—…ê·¸ë ˆì´ë“œí•˜ì—¬ ìµœëŒ€í•œ ì˜¤ë˜ ë²„í…¨ë³´ì„¸ìš”!

![image](https://github.com/user-attachments/assets/ca189996-d165-4839-9da9-d43b623e5d24)

## ê²Œì„ íŠ¹ì§•
- ë‹¤ì–‘í•œ íƒ€ì›Œ! => ê°ê¸° ë‹¤ë¥¸ íŠ¹ì„±ì„ ê°€ì§„ ê³ ì–‘ì´ íƒ€ì›Œë“¤ë¡œ ì „ëµì  í”Œë ˆì´<br>

![image](https://github.com/user-attachments/assets/4780cb66-578e-4297-83f3-c31bf093fad0)

<br>

- íƒ€ì›Œ ê°•í™”! => ê³¨ë“œë¥¼ ëª¨ì•„ íƒ€ì›Œë¥¼ ê°•í™”í•˜ê³  ë” ê°•ë ¥í•œ ê³µê²©ë ¥ íšë“<br>

![image](https://github.com/user-attachments/assets/d56179ff-1957-4ba2-ae67-c1883b60c572)

<br>

- ì›¨ì´ë¸Œ ì‹œìŠ¤í…œ! => ë¼ìš´ë“œê°€ ì§„í–‰ë ìˆ˜ë¡ ë”ìš± ê°•ë ¥í•´ì§€ëŠ” ì ë“¤ê³¼ì˜ ì „íˆ¬<br>

![image](https://github.com/user-attachments/assets/5ccb99a6-13da-4e3c-94dd-3a149747be5b)

<br>

- ë­í‚¹ ì‹œìŠ¤í…œ! => ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ê³¼ ê¸°ë¡ì„ ë¹„êµí•˜ë©° ê²½ìŸ<br>

![image](https://github.com/user-attachments/assets/e40553d9-82f1-4b5b-96ff-1dd83adeefa5)

<br>

# í”„ë¡œì íŠ¸ ê°œë°œ ê³¼ì •
## ì™€ì´ì–´ í”„ë ˆì„

![image](https://github.com/user-attachments/assets/536dd174-1b16-484b-b3af-c61717440db9)

<br>

## íŒŒì¼ êµ¬ì¡°

``` txt
ğŸ“¦ 
.gitignore
.prettierrc
â”œâ”€Â README.md
â”œâ”€Â package.json
â”œâ”€Â prisma
â”‚Â Â â””â”€Â schema.prisma
public
â”‚Â Â â”œâ”€Â assets
â”‚Â Â â”‚Â Â â”œâ”€Â monster.json
â”‚Â Â â”‚Â Â â”œâ”€Â monster_unlock.json
â”‚Â Â â”‚Â Â â””â”€Â tower.json
â”‚Â Â â”œâ”€Â htmls
index.html
login.html
modalHTMLs
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â gameOverModal.html
â”‚Â Â â”‚Â Â â”‚Â Â â”œâ”€Â loginModal.html
â”‚Â Â â”‚Â Â â”‚Â Â â””â”€Â registerModal.html
register.html
â”‚Â Â â”‚Â Â â””â”€Â test.html
â”‚Â Â â”œâ”€Â images
â”‚Â Â â””â”€Â src
â”‚Â Â Â Â Â â”œâ”€Â base.js
â”‚Â Â Â Â Â â”œâ”€Â constants.js
â”‚Â Â Â Â Â â”œâ”€Â game.js
â”‚Â Â Â Â Â â”œâ”€Â grid.js
â”‚Â Â Â Â Â â”œâ”€Â monster.js
â”‚Â Â Â Â Â â”œâ”€Â path.js
â”‚Â Â Â Â Â â”œâ”€Â socket.js
â”‚Â Â Â Â Â â”œâ”€Â tower.js
â”‚Â Â Â Â Â â”œâ”€Â towerControl.js
â”‚Â Â Â Â Â â””â”€Â webpages
â”‚Â Â Â Â Â Â Â Â â”œâ”€Â modals
â”‚Â Â Â Â Â Â Â Â â”‚Â Â â”œâ”€Â gameOverModal.js
â”‚Â Â Â Â Â Â Â Â â”‚Â Â â”œâ”€Â loginModal.js
â”‚Â Â Â Â Â Â Â Â â”‚Â Â â””â”€Â registerModal.js
â”‚Â Â Â Â Â Â Â Â â””â”€Â pages
â”‚           â”œâ”€Â common.js
â”‚Â Â Â Â Â Â Â Â Â Â Â â””â”€Â mainPage.js
â”œâ”€Â src
â”‚Â Â â”œâ”€Â app.js
â”‚Â Â â”œâ”€Â handlers
â”‚Â Â â”‚Â Â â”œâ”€Â base.hanlder.js
â”‚Â Â â”‚Â Â â”œâ”€Â game.handler.js
â”‚Â Â â”‚Â Â â”œâ”€Â handlerMapping.js
â”‚Â Â â”‚Â Â â”œâ”€Â helper.js
â”‚Â Â â”‚Â Â â”œâ”€Â monster.handler.js
â”‚Â Â â”‚Â Â â”œâ”€Â register.handler.js
â”‚Â Â â”‚Â Â â”œâ”€Â round.handler.js
â”‚Â Â â”‚Â Â â””â”€Â tower.handler.js
â”‚Â Â â”œâ”€Â init
â”‚Â Â â”‚Â Â â”œâ”€Â assets.js
â”‚Â Â â”‚Â Â â””â”€Â socket.js
â”‚Â Â â”œâ”€Â middlewares
â”‚Â Â â”‚Â Â â””â”€Â auth.middleware.js
â”‚Â Â â”œâ”€Â models
â”‚Â Â â”‚Â Â â”œâ”€Â rank.model.js
â”‚Â Â â”‚Â Â â”œâ”€Â roundInfo.model.js
â”‚Â Â â”‚Â Â â”œâ”€Â tower.model.js
â”‚Â Â â”‚Â Â â”œâ”€Â user.model.js
â”‚Â Â â”‚Â Â â””â”€Â userData.model.js
â”‚Â Â â”œâ”€Â routes
â”‚Â Â â”‚Â Â â”œâ”€Â rank.router.js
â”‚Â Â â”‚Â Â â””â”€Â user.router.js
â”‚Â Â â””â”€Â utils
â”‚Â Â Â Â Â â””â”€Â prisma
â”‚Â Â Â Â Â Â Â Â â””â”€Â index.js
â””â”€Â yarn.lock
```
<br>

## íŒ¨í‚· êµ¬ì¡°
https://docs.google.com/spreadsheets/d/1ofOjLuqbQLizO0p6cQfGeLKSvWPgz5VZdwNqiwrR-ps/edit?usp=sharing
### ê³µí†µ íŒ¨í‚·

| í•„ë“œ ëª…          | íƒ€ì…     | ì„¤ëª…                         |
| ------------- | ------ | -------------------------- |
| userId        | INT    | ìš”ì²­ì„ ë³´ë‚´ëŠ” ìœ ì €ì˜ ID             |
| handlerId     | INT    | ìš”ì²­ì„ ì²˜ë¦¬í•  ì„œë²„ í•¸ë“¤ëŸ¬ì˜ ID         |
| clientVersion | STRING | í˜„ì¬ í´ë¼ì´ì–¸íŠ¸ ë²„ì „ (â€1.0.0â€) (ê³ ì •) |
| payload       | JSON   | ìš”ì²­ ë‚´ìš©                      |

### ì´ë²¤íŠ¸ë³„ íŒ¨í‚· ì˜ˆì‹œ

| í•„ë“œ ëª…      | íƒ€ì…   | ì„¤ëª…                   |
| --------- | ---- | -------------------- |
| type      | INT  | íƒ€ì›Œ ì—ì…‹ì—ì„œ ì •ì˜ëœ íƒ€ì›Œì˜ Type |
| x         | JSON | íƒ€ì›Œì˜ ì„¤ì¹˜ ì¢Œí‘œ            |
| y         | JSON | íƒ€ì›Œì˜ ì„¤ì¹˜ ì¢Œí‘œ            |
| timestamp | DATE | íƒ€ì›Œê°€ ì„¤ì¹˜ëœ ì‹œê°           |
| index     | INT  | íƒ€ì›Œ ë°°ì—´ì—ì„œì˜ ì¸ë±ìŠ¤ ê°’       |

## í•„ìˆ˜ ê¸°ëŠ¥ ë¦¬ìŠ¤íŠ¸
``` txt
1. íšŒì›ê°€ì… / ë¡œê·¸ì¸ ê¸°ëŠ¥
client| public/src/webpages/pages/mainPage.js
íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ ê´€ë¦¬í•˜ëŠ” js

2. ìœ ì € ë³„ ê²Œì„ ë°ì´í„° ê´€ë¦¬
server| src/models/userData.model.js

3. í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ í•˜ëŠ” ì´ë²¤íŠ¸ ì¢…ë¥˜ ì •ì˜ ë° ì½”ë“œ êµ¬í˜„
4. í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œ ì†¡ì‹ í•˜ëŠ” ì´ë²¤íŠ¸ ì¢…ë¥˜ ì •ì˜ ë° ì½”ë“œ êµ¬í˜„
client| public/src/socket.js
server| src/register.handler.js

5. ìœ ì € ë³„ ìµœê³  ê¸°ë¡ ìŠ¤ì½”ì–´ ì €ì¥
server| src/rank.model.js
```
<br>

## í•„ìˆ˜ ê¸°ëŠ¥ êµ¬í˜„
1. íšŒì›ê°€ì… / ë¡œê·¸ì¸ ê¸°ëŠ¥<br>
![image](https://github.com/user-attachments/assets/e5ba5383-e073-4406-8440-54c8034b1fb8)


2. ìœ ì €ë³„ ê²Œì„ ë°ì´í„° ê´€ë¦¬<br>
```js
const userData = {};

export const createUserData = (uuid) => {
	userData[uuid] = {};
};

export const getUserData = (uuid) => {
	return userData[uuid];
};

export const setUserData = (uuid, round, timestamp, gold) => {
	userData[uuid] = { round, timestamp, gold };
};
```

3. í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ í•˜ëŠ” ì´ë²¤íŠ¸<br>
(ì›¹ì†Œì¼“ ì´ë²¤íŠ¸ ëª…ì„¸ì„œ í‘œë¥¼ ì²¨ë¶€í•  í…Œë‹ˆ ë°˜ë“œì‹œ!! ë³¸ì¸ íŒŒíŠ¸ ì‘ì„±í•´ì£¼ì„¸ìš”)

| í•¸ë“¤ëŸ¬ ID | í•¸ë“¤ëŸ¬ í•¨ìˆ˜ëª…           | payload                                                             | ì—­í•                                                       |
| ------ | ----------------- | ------------------------------------------------------------------- | ------------------------------------------------------- |
| 2      | gameStart         | none                                                                | ìœ ì € ë¼ìš´ë“œë¥¼ ìƒì„±                                              |
| 3      | gameOver          | timestamp,round                                                     | ê²Œì„ ì¢…ë£Œ ì‹œ ìµœì¢… ê²€ì¦                                           |
| 5      | createTower       | type, x, y, timestamp, index                                        | ì„œë²„ì— íƒ€ì›Œ ê¸°ë¡                                               |
| 6      | sellingTower      | x, y, type                                                          | ì„œë²„ì— íƒ€ì›Œ ì‚­ì œ                                               |
| 7      | upgradeTower      | type, x, y, level                                                   | ìœ ì € íƒ€ì›Œ ë°ì´í„° ê°±ì‹                                             |
| 8      | updateUserGold    | monster.gold                                                        | ìœ ì € ê³¨ë“œ ì—…ë°ì´íŠ¸                                              |
| 11     | moveRoundHandler  | round, score, monsterkill, gold, timenow, ë“±ë“± ì ìˆ˜ ê²€ì¦ì— í•„ìš”í•œ ê²ƒë“¤.         | ë¼ìš´ë“œ ë„˜ì–´ê°ˆë•Œ ì‹œê°„ ì €ì¥(ì‹œê°„ í™•ì¸ìš©), ì ìˆ˜, ëª¬ìŠ¤í„° í‚¬ìˆ˜ ë“±ë“± ì €ì¥í•´ì„œ ê²Œì„ ì—”ë“œì—ì„œ ê²€ì¦ìš©. |
| 12     | stopCreateMonster |                                                                     | ëª¬ìŠ¤í„°ì˜ ìƒì„± ì£¼ê¸°ë¥¼ ë§‰ê¸° ìœ„í•¨                                       |
| 13     | monsterCreate     | round                                                               | roundInfoì˜ ìƒì„±ì£¼ê¸°ë¥¼ roundë¡œ ê°€ì ¸ì™€ì„œ ê³„ì‚° í›„ ìƒì„±ì£¼ê¸°ë§ˆë‹¤ í´ë¼ì—ê²Œ ì†¡ì‹         |
| 14     | attackTower       | atteckerX ,atteckerY , hitEntity ,x ,y , timestemp , feverTriggered | íƒ€ì›Œê°€ íƒ€ê²©í• ë•Œ ì •ë³´ë¥¼ ì„œë²„ì— ì €ì¥.                                    |
| 20     | setBaseInitHp     |                                                                     | ê²Œì„ ìµœì´ˆ ì‹œì‘ ì‹œ Base ì˜ ë””í´íŠ¸ ì²´ë ¥ì„ ë°›ì•„ì™€ ì„¤ì •í•˜ê¸° ìœ„í•¨                   |

5. í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œ ì†¡ì‹ í•˜ëŠ” ì´ë²¤íŠ¸<br>
(ì›¹ì†Œì¼“ ì´ë²¤íŠ¸ ëª…ì„¸ì„œ í‘œë¥¼ ì²¨ë¶€í•  í…Œë‹ˆ ë°˜ë“œì‹œ!! ë³¸ì¸ íŒŒíŠ¸ ì‘ì„±í•´ì£¼ì„¸ìš”)

| í•¸ë“¤ëŸ¬ID | data                               |
| ----- | ---------------------------------- |
| 2     | initRoundInfo, unlockMonsters      |
| 3     | message, userName, highScore, time |
| 5     |                                    |
| 6     |                                    |
| 7     |                                    |
| 8     |                                    |
| 11    | nextRoundInfo, unlockMonsters      |
| 12    |                                    |
| 13    |                                    |
| 14    |                                    |
| 20    | baseInitHp                         |

## ë„ì „ ê¸°ëŠ¥ ë¦¬ìŠ¤íŠ¸
``` txt
1. íƒ€ì›Œ í™˜ë¶ˆ ê¸°ëŠ¥
client| public/src/tower.js -> sellTowerí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

2. íŠ¹ì • íƒ€ì›Œ ì—…ê·¸ë ˆì´ë“œ ê¸°ëŠ¥
client| public/src/tower.js -> upgradeTowerí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

3. ê·¸ë¦¬ë“œ í˜•ì‹ì˜ ë§µìœ¼ë¡œ ë³€ê²½
client| public/src/path.js -> drawGridAndPathí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

4. í”¼ë²„ íƒ€ì„ ê¸°ëŠ¥
client| public/src/tower.js -> feverTimeí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
```

## ë„ì „ ê¸°ëŠ¥ êµ¬í˜„
1. íƒ€ì›Œ í™˜ë¶ˆ & ì—…ê·¸ë ˆì´ë“œ ê¸°ëŠ¥<br>

![image](https://github.com/user-attachments/assets/d56179ff-1957-4ba2-ae67-c1883b60c572)

<br>

### addEventListenerë¡œ í´ë¦­ ì´ë²¤íŠ¸ ê°ì§€
#### í™˜ë¶ˆ ë²„íŠ¼ 
- í´ë¼ì´ì–¸íŠ¸: íƒ€ì›Œ ê°ì²´ ì‚­ì œ í›„ ê³¨ë“œ í™˜ë¶ˆ, ì„œë²„ë¡œ ë°ì´í„° ì†¡ì‹  
- ì„œë²„: í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìˆ˜ì‹ ë°›ì€ ë°ì´í„° ê²€ì¦, ê²€ì¦ ê²°ê³¼ ë°˜í™˜
#### ì—…ê·¸ë ˆì´ë“œ ë²„íŠ¼
- í´ë¼ì´ì–¸íŠ¸ : íƒ€ì›Œ ë°ì´í„° ì—…ë°ì´íŠ¸, ê³¨ë“œ ì°¨ê°, ì„œë²„ë¡œ ë°ì´í„° ì†¡ì‹ 
- ì„œë²„: í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìˆ˜ì‹ ë°›ì€ ë°ì´í„° ê²€ì¦, ê²€ì¦ ê²°ê³¼ ë°˜í™˜

3. ê·¸ë¦¬ë“œ í˜•ì‹ì˜ ë§µìœ¼ë¡œ ë³€ê²½
#### ëœë¤ ì›Œí¬ ì´ë¡ ì´ë€?
ì£¼ì–´ì§„ ê³µê°„ì—ì„œ ë§¤ ìˆœê°„Â ëœë¤ìœ¼ë¡œ, ì¦‰ í™•ë¥ ì ìœ¼ë¡œ ì´ë™í•˜ëŠ” ëª¨ìŠµì„ ìˆ˜í•™ì ìœ¼ë¡œ í‘œí˜„í•œ ì•Œê³ ë¦¬ì¦˜
#### (1) ê¸°ë³¸ì ì¸ ë³€ìˆ˜ ì„ ì–¸
```js
const path = [];
const visited = new Set(); // ë°©ë¬¸í•œ ì¢Œí‘œë¥¼ ì €ì¥í•˜ëŠ” Set
let currentX = start.x;
let currentY = start.y;

// ì‹œì‘ì  ì¶”ê°€
path.push({ x: currentX, y: currentY });
visited.add(`${currentX},${currentY}`); // ë°©ë¬¸í•œ ì¢Œí‘œ ì¶”ê°€

// ì´ë™ ê°€ëŠ¥í•œ ë°©í–¥ (ìƒí•˜ì¢Œìš°)
const directions = [
		{ x: 1, y: 0 },   // ì˜¤ë¥¸ìª½
		{ x: -1, y: 0 },  // ì™¼ìª½
		{ x: 0, y: 1 },   // ìœ„ìª½
		{ x: 0, y: -1 }   // ì•„ë˜ìª½
];
```
#### (2) ëœë¤í•œ ê²½ë¡œ ìƒì„±
ì¡°ê±´ 1 : ëª¬ìŠ¤í„°ê°€ ì´ë¯¸ ì§€ë‚˜ê°„ ì¢Œí‘œëŠ” ë‹¤ì‹œ ì§€ë‚˜ê°ˆ ìˆ˜ ì—†ë‹¤.
ì¡°ê±´ 2 : íƒ€ì›Œë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•´, ëª¬ìŠ¤í„°ëŠ” ë°˜ë“œì‹œ â€œ2ì¹¸ì”©â€ ì›€ì§ì—¬ì•¼ í•œë‹¤.
```js
while (path.length < minlength) {
	const possibleMoves = directions
		.map((dir) => ({
			dir,
			mid: { x: currentX + dir.x, y: currentY + dir.y }, // ì¤‘ê°„ ì¢Œí‘œ
			final: { x: currentX + dir.x * 2, y: currentY + dir.y * 2 }, // ìµœì¢… ì¢Œí‘œ
		}))
		.filter(
			(move) =>
				!visited.has(`${move.mid.x},${move.mid.y}`) && // ì¤‘ê°„ ì¢Œí‘œ ë¯¸ë°©ë¬¸
				!visited.has(`${move.final.x},${move.final.y}`) && // ìµœì¢… ì¢Œí‘œ ë¯¸ë°©ë¬¸
				move.final.x >= Math.min(start.x, end.x) &&
				move.final.x <= Math.max(start.x, end.x) && // x ë²”ìœ„ ì²´í¬
				move.final.y >= Math.min(start.y, end.y) &&
				move.final.y <= Math.max(start.y, end.y), // y ë²”ìœ„ ì²´í¬
		);
		if (possibleMoves.length === 0) {
	// ë” ì´ìƒ ì´ë™í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ê²½ë¡œë¥¼ ì¬ìƒì„±
	return generatePath(start, end, minlength);
}
```

4. í”¼ë²„ íƒ€ì„ ê¸°ëŠ¥
![image](https://github.com/user-attachments/assets/7434e522-e685-4142-990d-4aad956ffce0)

